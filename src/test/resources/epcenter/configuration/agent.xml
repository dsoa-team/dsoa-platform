<?xml version="1.0" encoding="UTF-8" ?>
<agents>
	<agent id="ResponseTimeAgent">
		<description>Response time from invocation</description>
		<transformer type="mapping">
			<input-events>
				<input-event type="InvocationEvent"/>
			</input-events>
			<output-events >
				<output-event type="ResponseTime">
					<mapping>
						<property id="responseTime">InvocationEvent.responseTimestamp - InvocationEvent.requestTimestamp</property>
					</mapping>
				</output-event>
				<output-event type="AvgResponseTimeEvent">
					<mapping>
						<property id="value" statistic="avg">ResponseTime.responseTime</property>
					</mapping>
				</output-event>
			</output-events>
		</transformer>
	</agent>
	
	<agent id="AvgResponseTimeAgent">
		<description>Response time from invocation</description>
		<transformer type="mapping">
			<input-events>
				<input-event type="ResponseTimeEvent" windowType="length_batch" windowSize="10"/>
			</input-events>
			
			<output-events >
				<output-event type="AvgResponseTimeEvent">
					<mapping>
						<property id="id" generated="true" />
						<property id="timestamp" generated="true" />
						<property id="value" statistic="avg">ResponseTime.responseTime</property>
					</mapping>
				</output-event>
			</output-events>
		</transformer>
	</agent>

	<agent>
		<name>ResponseTimeAgent</name>
		<description>Availability from service</description>
		<transformer type="query">
			<query>
				INSERT INTO ResponseTimeEvent(id, timestamp, responseTime)
				SELECT id, timestamp, InvocationEvent.responseTimestamp - InvocationEvent.requestTimestamp as responseTime
				FROM InvocationEvent
			</query>
		</transformer>
	</agent>

			<!-- 
			query timestamp e id gerados (esper)
			INSERT into ResponseTime 
			SELECT InvocationEvent.response.timestamp - InvocationEvent.request.timestamp as value
			FROM InvocationEvent
			
			we could use janino (evaluate expression)
			 -->
	<agent>
		<name>Availability</name>
		<description>Availability from service</description>
		<transformer type="class">
			<input-events>
				<event type="InvocationEvent"/>
			</input-events>
			<output-events >
				<event type="Availabilty"/>
			</output-events>
			
			<classname>br.ufpe.cin.dsoa.ping</classname>
		</transformer>
	</agent>
</agents>